{{define "header"}}

<!DOCTYPE html>
<html lang="ko">
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="description" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
	<title>{{.Title}}</title>

	<!-- CSS -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css" />
	<link rel="stylesheet" href="/static/css/tui-pagination.css" />
	<link rel="stylesheet" href="https://uicdn.toast.com/tui-grid/latest/tui-grid.css" />
	<link rel="stylesheet" type="text/css" href="/static/css/common.css">
	<link rel="stylesheet" type="text/css" href="/static/css/layout.css">
	<link rel="stylesheet" type="text/css" href="/static/css/board.css">
	<link rel="stylesheet" type="text/css" href="/static/css/main.css">

	<!-- 폰트 -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Noto+Sans+KR:wght@300;400;500;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

	<!-- 아이콘 -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

	<!-- 스와이퍼 -->
	<link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" />
	<script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>

	<!-- JS -->
	<script src="/static/js/jquery-3.5.1.min.js"></script>
	<script src="/static/js/index.js" type="text/javascript"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.js"></script>
	<script src="/static/js/tui-pagination.js"></script>
	<script src="/static/js/common.js" type="text/javascript"></script>
	<script src="/static/js/tui-grid.js"></script>
	
	<!-- 구글차트 -->
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script>
        let conn;
    
        // 웹소켓 연결
        window.onload = () => {
            if (window['WebSocket']) {
                conn = new WebSocket('ws://' + document.location.host + '/ws');
                console.log("웹소켓 연결")
                // 소켓 종료될 때
                conn.onclose = evt => {
                    let log = document.createElement('div');
                    log.innerHTML = `<b>Connection closed.</b>`;
                    //logMessage(log)
                };
    
                // 메시지 수신했을 때
                conn.onmessage = evt => {
                    console.log(evt.data);
                    let message = evt.data;

                    //logMessage(message)
					console.log('웹소켓 메시지 수신:', message);
                    processMessage(message);
                };
            } else {
                //let log = document.createElement('div');
                //log.innerHTML = `<b>Your browser does not support WebSockets.</b>`;
                //logMessage(log)
            }
    
        }
    
        // 화면 교체
        function setView(element) {
            while($show.hasChildNodes()) {
                $hide.appendChild($show.firstChild);
            }
            $show.append(element);
        }
    
        // 수신한 메시지 파싱 및 처리
        function processMessage(message) {
            message = JSON.parse(message)
            if (message.target !== "kiosk") {
                return false;
            }
    
            // 응답 메시지인 경우
            if (message.data === "ok") {
                return false;
            }
    
            // TODO - 임시 삭제
            // respondMessage(message);
    
            message.data = JSON.parse(message.data);
            switch (message.data.type) {
                case 'view':
                    let view = window[message.data.data];
                    if (!view) {
                        console.error("Cannot find view with id: " + message.data.data);
                        return false;
                    }
                    setView(view);
                    break
                case 'alert':
                    alert(message.data.data);
            }
        }
    
        // 응답 메시지 전송
        function respondMessage(requestMessage) {
            let responseMessage = {
                id: requestMessage.id,
                sender: requestMessage.target,
                target: requestMessage.sender,
                timestamp: new Date(),
                data: "ok"
            };
            conn.send(JSON.stringify(responseMessage));
        }
    
        // 이벤트 트리거 메시지 전송
        function triggerEvent(eventName, eventData = null) {
            let requestMessage = {
                id: crypto.randomUUID(),
                sender: "kiosk",
                target: "event",
                timestamp: new Date(),
                data: JSON.stringify({
                    event_name: eventName,
                    event_data: eventData
                })
            };
            conn.send(JSON.stringify(requestMessage));
        }
    
        function createElementFromHtml(htmlString) {
            const div = document.createElement('div');
            div.innerHTML = htmlString.trim();
            return div.firstElementChild;
        }
    
        function logMessage(message) {
            message = JSON.parse(message)
            let background = message.data === 'ok' ? '' :
                            message.sender === 'kiosk' ? 'bg-primary-subtle' : 'bg-danger-subtle';
            let log = createElementFromHtml(`
                        <li class="list-group-item ${background}">
                            <div><b>sender</b>: ${message.sender} -> <b>target</b>: ${message.target}</div>
                            <div><b>id</b>: ${message.id}</div>
                            <div><b>timestamp</b>: ${message.timestamp.replace('T', ' ').slice(0, -5)}</div>
                            <div><b>data</b>: ${message.data}</div>
                        </li>
                    `);
    
            $log.appendChild(log)
            $log.scrollTop = $log.scrollHeight - $log.clientHeight
        }
    </script>
</head>


<!-- main page header -->
<header id="main_header" class="main-header">
    <div class="header-wrap">
        <div class="header-area">
            <div class="header-left">
                <!-- <div class="logo-box">
                    <h1 class="logo">
                        <a href="/">
                            <img src="" alt="">
                        </a>
                    </h1>
                </div> -->
                <!-- <div class="menu-box">
                    <ul class="gnb clear">
                        <li class="menu-item">
                            <a href="/company/company_information"><span>메뉴 아이템 1</span></a>
                            <ul class="lnb">
                                <li class="menu-item"><a><span>2차 메뉴 아이템 1</span></a></li>
                                <li class="menu-item"><a><span>2차 메뉴 아이템 2</span></a></li>
                                <li class="menu-item"><a><span>2차 메뉴 아이템 3</span></a></li>
                                <li class="menu-item"><a><span>2차 메뉴 아이템 4</span></a></li>
                            </ul>
                        </li>
                        <li class="menu-item">
                            <a href="/manage/general_information"><span>메뉴 아이템 2</span></a>
                            <ul class="lnb">
                                <li class="menu-item"><a><span>2차 메뉴 아이템 1</span></a></li>
                                <li class="menu-item"><a><span>2차 메뉴 아이템 2</span></a></li>
                                <li class="menu-item"><a><span>2차 메뉴 아이템 3</span></a></li>
                                <li class="menu-item"><a><span>2차 메뉴 아이템 4</span></a></li>
                            </ul>
                        </li>
                        <li class="menu-item">
                            <a href="/notice/notice"><span>메뉴 아이템 3</span></a>
                            <ul class="lnb">
                                <li class="menu-item"><a href="/notice/notice"><span>공지사항</span></a></li>
                                <li class="menu-item"><a href="/qna/qna"><span>QnA</span></a></li>
                            </ul>
                        </li>
                        <li class="menu-item"><a href="/user/mypage"><span>마이페이지</span></a></li>
                    </ul>
                </div> -->
            </div>
            <div class="header-right" style="margin: 30px;">대전 푸르지오 2차 101동 1-4라인</div>
        </div>
        <div class="hidden-layer dep2-bg"></div>
    </div>
</header>
{{end}}
