{{define "input/input_item_error"}}
{{template "header" .}}

<main id="main">
    <div class="content-wrap">
        <div class="fixed-btn">
            <button class="btn-normal home_btn">첫 화면으로</button>
        </div>
        <!-- 입고 실패 -->
        <div class="msg-wrap home_btn">
            <div class="msg-body">
                <div class="img-wrap">
                    <img src="/static/images/ico_report_red.png" alt="">
                </div>
                <div class="fail-msg">
                    <p>아래 사유로 입고에 실패했습니다.</p>
                    <div id="error_msg">
                        <span></span>
                    </div>
                    
                </div>
                <p class="msg">택배를 다시 입고해주세요.</p>
            </div>
            <div class="msg-footer">
                <div class="btn-wrap">
                    <button class="btn-normal cancel_btn">입고 취소</button>
                </div>
            </div>
        </div>
    </div>
</main>
</div>
</body>
</html>

<script>
    let getLink = window.location.search;
    let getSplit = getLink.split('=');	//getLink를 '='를 기준으로 두 배열 요소로 분리
    let getError = getSplit[1];	//분리한 배열 중 두번째 요소 변수에 넣기
    let decodeError = decodeURI(getError)
    console.log(decodeError);
    getHtml(decodeError);

    function getHtml(error){
        let getHtml = `<span>${error}</span>`
        $('#error_msg').html(getHtml)
    }

    /* 물품 회수 시 이 전으로 */ 
    setTimeout(function(){
        axios.post('/input/senseItem').then(res => {
            if(res.data.status == 200){
                    location.replace(res.data.data)
            } else{
                console.log(res)
                alert(res)
            }
            
        }).catch(err => {
            console.log(err);
            alert(err)
        });
    }, 5000);

    /* 입고 취소 */
    function send_stop_info() {
        let request = JSON.stringify({
            step: "2",
        });

        axios.post('/input/stop_input', request).then(res => {
            if(res.data.status == 200){
                alert('입고를 취소하셨습니다.');
                location.href='/input/cancel_input_item'
            } else{
                console.log(res.data.error)
                alert(res.data.error)
            }
            
        }).catch(err => {
            console.log(err);
            alert(err.response.data.error)
        });
    }

    $('.home_btn').click(function(){
        send_stop_info();
    });

    $('.cancel_btn').click(function(){
        send_stop_info();
    });
    
</script>

{{end}}1