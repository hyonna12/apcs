{{define "output/item_list"}}
{{template "header" .}}

<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>

<div class="main-page" style="display: none;">
    <!-- <div class="main-bg"></div>
    <div class="main-con"></div> -->
</div>

<div class="sub-right" style="background-color: white;">
    <h2 class="sub-right-title">귀하의 호수</h2>
    <div id="address">
    </div>
    <div class="sub-right-con">
        <div class="sub-con-sec">
            <form action="/output/ongoing" method="post">
                <table style="border: 2px solid; width:100%; text-align: center;">
                    <thead id="$thead">
                    <tr>
                        <th style="padding: 10px;"><i class="fa fa-check"></i>선택</th>
                        <th style="padding: 10px;">택배사</th>
                        <th style="padding: 10px;">운송장 번호</th>
                        <th style="padding: 10px;">입고 일시</th>
                    </tr>
                    </thead>
                    <tbody id="$tbody">
                    </tbody>
                </table>
                <div class="board-top-search" style="float: left;">
                    <button type="button" class="btn-small" id="$output_request_btn">선택 찾기</button>

                    <button type="button" class="btn-small" id="$back_btn"><a href="/output/regist_address">이전으로</a></button>
                    <button type="button" class="btn-small" id="$home_btn"><a href="/">처음으로</a></button>
                </div>
            </form>

        </div>
    </div>
</div>


<script>
    const urlParams = new URLSearchParams(window.location.search);
    const address = urlParams.get('address');

    // db에서 유저 호수와 택배 리스트 가져오기
    axios.get('/output/get_item_list?address=' + address)
        .then(axiosResult => {
            let itemListResponses = axiosResult.data.data;
            console.log(itemListResponses);
            itemListResponses.forEach(item => {
                let tr = createElementFromHtml(`
                    <table>
                        <tr>
                            <td>
                                <input type="checkbox" name="item_id" value="${item.item_id}">
                            </td>
                            <td>${item.delivery_company}</td>
                            <td>${item.tracking_number}</td>
                            <td>${item.input_date}</td>
                        </tr>
                    </table>
                `);

                $tbody.append(tr.querySelector('tr'));
            });
        })
        .catch(err => {
            console.error(err)
        });

    $output_request_btn.onclick = e => {
        let $checkboxes = document.getElementsByName("item_id");
        let nothingChecked = true;
        $checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                nothingChecked = false;
            }
        })

        if (nothingChecked) {
            alert("찾을 물품을 하나 이상 선택해주세요.");
            return false;
        }

        e.target.closest('form').submit();
    };

</script>
{{end}}