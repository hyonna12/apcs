{{template "layout.html" .}}
{{define "content"}}
<main id="main">
    <div class="content-wrap">
        <div class="fixed-btn">
            <button class="btn-normal"><a href="/output/register_address">이전 화면으로</a></button>
            <button class="btn-normal"><a href="/">첫 화면으로</a></button>
        </div>
        <div class="list-box">
            <form action="/output/ongoing" method="post">
                <div class="list-top">
                    <p class="title">귀하의 호수</p>
                    <div id="address"><p class="value"></p></div>
                </div>
                <div class="list-tbl-wrap">
                    <table class="list-tbl">
                        <colgroup>
                            <col width="10%">
                            <col width="22%">
                            <col width="33%">
                            <col width="35%">
                        </colgroup>
                        <thead>
                        <tr>
                            <th></th>
                            <th>택배사</th>
                            <th>운송장번호</th>
                            <th>입고 일시</th>
                        </tr>
                        </thead>
                        <tbody id="tbody">
                        </tbody>
                    </table>
                </div>
                <!-- <p class="list-count"><span></span>개 선택</p> -->

                <div class="btn-wrap">
                    <button class="btn-normal" id="$output_request_btn">택배 찾기</button>
                </div>
            </form>
        </div>
    </div>
</main>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const address = urlParams.get('address');

    data = `<p class="value">${address}호</p>`;

    $('#address').html(data);

    // db에서 유저 호수와 택배 리스트 가져오기
    axios.get('/output/get_item_list?address=' + address)
        .then(axiosResult => {
            let itemListResponses = axiosResult.data.data;
            let tr = '';
            itemListResponses.forEach(item => {
                tr += `
                    <tr>
                        <td>
                            <div class="chk-item">
                                <input type="checkbox" id="chk${item.item_id}" name="item_id" value="${item.item_id}">
                                <label for="chk${item.item_id}" class="label-cb"></label>
                            </div>
                        </td>
                        <td>${item.delivery_company}</td>
                        <td>${item.tracking_number}</td>
                        <td>${item.input_date}</td>
                    </tr>
                `;
            });
            $('#tbody').html(tr);
        })
        .catch(err => {
            console.error(err)
        });

    $output_request_btn.onclick = e => {
        let $checkboxes = document.getElementsByName("item_id");
        let nothingChecked = true;
        $checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                nothingChecked = false;
            }
        })

        if (nothingChecked) {
            alert("찾을 물품을 하나 이상 선택해주세요.");
            return false;
        }
        e.target.closest('form').submit();
    };

</script>
{{end}}