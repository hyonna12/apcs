{{define "input/regist_delivery"}}
{{template "header" .}}

<div class="sub-right">
    <h2 class="sub-right-title">물품기사 정보 입력</h2>
    <div class="sub-right-con">
        <div class="sub-con-sec join-sec">
            <div class="form-wrap">
                <div style="margin-bottom: 30px;">아래의 정보를 입력하세요</div>
                <form action="">
                    <div class="input-item">
                        <label for="delivery_company">소속회사</label>
                        <select name="delivery_company" id="delivery_company">
                        </select>
                    </div>
                    <div class="input-item">
                        <label for="tracking_number">운송장 번호</label>
                        <input type="text" id="tracking_number">
                    </div>
                    <div class="input-item">
                        <label for="phone_num">기사님 연락처</label>
                        <input type="text" id="phone_num">
                    </div>
                </form>
            </div>
            <div class="btn-wrap">
                <button class="btn-normal" id="user_regist_insert_btn"><a href="/input/input_item">입력완료</a></button><br><br>
                <button class="btn-small" id="home_btn"><a href="/">첫 화면으로</a></button>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<script>
    // 택배 회사 리스트 조회
    let request = {
        target: "event",
        sender: "kiosk",
        data: JSON.stringify({
            event_name: "DeliveryInfoRequested",
            event_data: "ok" 
        }),
    };

    axios.post('/output/get_delivery_list', request).then(res => {
        console.log(res.data)
        let delivery_list = res.data.eventData;
        let list = '';
        console.log(delivery_list)
        for(let i=0; i<delivery_list.length; i++){
            list += `
                <option value="${delivery_list[i]}">${delivery_list[i]}</option> 
            `
        
            $('#delivery_company').html(list);
        }
    });

   // 물품기사 정보 전송 - 수정해야함(선택 박스)
    function delivery_info() {
        let eventData = JSON.stringify({
            delivery_company: $("select[name='delivery_company']").val(),
            tracking_number: $('#tracking_number').val(),
            phone_num: $('#phone_num').val(),
        });

        let request = {
            target: "event",
            sender: "kiosk",
            data: ({
                event_name: "DeliveryIdSubmitted",
                event_data: eventData 
            }),
        };

        if ($('#delivery_company').val() == '') {
            alert('소속회사를 입력해주세요.');
            return false;
        }
        if ($('#tracking_number').val() == '') {
            alert('운송장 번호를 입력해주세요.');
            return false;
        }

        axios.post('/input/get_delivery_info', request).then(res => {
            console.log(res.data)
            alert('입력되었습니다.');
            
            if(res.data == true){
                location.href='/input/input_item'
            } else{
                location.href='/input/regist_delivery_error'

            }
            
        }).catch(err => {
            console.log(err);
        });
    }
    
</script>
{{end}}